<!--
	Table Test Layout
	By: Benjamin Zackin
	Last Modified: 7/13/2016
-->

<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Table Test Layout</title>
	<style> 
		* {
			margin:0px;
		}
		/*Set up Port View table styles*/
		#portView, #portView th, #portView td {
			border:1px solid black;
		}
		#portView {
			border-collapse:collapse;
		}
		#portView th {
			border-bottom:0px none;
		}
		#portView td {
			border-top:0px none;
			border-bottom:1px solid black;
		}

		/*Set up Link Pair table styles*/
		.linkPair, .linkPair th, .linkPair td {
			border:1px solid black;
			margin:10px;
		}
		.linkPair {
			border-collapse:collapse;
		}
		.linkPair th {
			top:0px;
			bottom:0px;
			min-width:200px;
			min-height:90px;
			margin:0px;
			background-color:green;
		}
		.linkPair td {
			top:0px;
			bottom:0px;
			min-width:200px;
			min-height:90px;
			margin:0px;
			background-color:blue;
			font-weight:bold;
		}
		.triggerSocket {
			min-width:200px;
			min-height:90px;
			margin:0px;
			background-color:green;
			border:1px dashed white;
		}
		.actionSocket {
			min-width:200px;
			min-height:90px;
			margin:0px;
			background-color:blue;
			border:1px dashed white;
			font-weight:bold;
		}
		.triggerBlock {
			top:0px;
			bottom:0px;
			min-width:200px;
			min-height:50px;
			margin:10px;
			background-color:lightgreen;
		}
		.actionBlock {
			top:0px;
			bottom:0px;
			min-width:200px;
			min-height:50px;
			margin:10px;
			background-color:lightblue;
		}
		.newTrigger {
			margin:10px;
			float:left;
		}
		.newAction {
			margin:10px;
		}
		.codeScreen {
			width:100%;
			background-color: grey;
		}
	</style>
</head>

<body>
	<div id="header">
		<h1>Interface Trial 2: Tables</h1>
	</div>

	<div id="nav">
		<button>New</button>
		<button>Open</button>
		<button>Save</button>
		<button>Print</button>
		<button>Deploy</button>
		<button>Run</button>
		<button>Stop</button>
	</div>

	<div>
		<table id="portView">
			<caption>PORT VIEW</caption>
			<tr>
				<th>Port 1 </th>
				<th>Port 2</th>
				<th>Port 3</th>
				<th>Port 4</th>
			</tr>
			<tr>
				<td>NONE</td>
				<td>NONE</td>
				<td>NONE</td>
				<td>NONE</td>
			</tr>
			<tr>
				<th>Port A</th>
				<th>Port B</th>
				<th>Port C</th>
				<th>Port D</th>
			</tr>
			<tr>
				<td>NONE</td>
				<td>NONE</td>
				<td>NONE</td>
				<td>NONE</td>
			</tr>
		</table>
	</div>

<div id="codeScreen" onstart="setScreen()"></div>
<button class="newTrigger" onclick="newTable()">Click to Add a Trigger</button>
	
	

	<script>
		function setScreen() {
			var  codingScreen = document.createElement("div");
			codingScreen.className = "codeScreen";
			return;
		}

		var triggerCounter = 0;

		function newTable() {
			console.log("trigger button pressed!");
			var tableScreen = document.getElementById("codeScreen");
			var thisTable = document.createElement("table");
			thisTable.className = "linkPair";
			var tr = document.createElement("tr");

			var th0 = document.createElement("th");
			//th0.innerHTML = "This is a Trigger Block!";
			th0 = makeSocket(th0, triggerCounter, true);
			tr.appendChild(th0);

			var td1 = document.createElement("td");
			var button = makeButton(triggerCounter, true);	
			td1.appendChild(button);

			tr.appendChild(td1);
			thisTable.appendChild(tr);
			tableScreen.appendChild(thisTable);
			console.log("new trigger created!");
			console.log("trigger counter = "+ triggerCounter);
			return;
		}
		function newRow(idNum) {
			console.log("action button pressed in table number " + idNum +"!");
			var thisTable = document.getElementsByClassName("linkPair")[idNum];
			console.log(thisTable);

			var numRows = thisTable.rows.length;
			console.log("This table has " + numRows + " rows");
			thisTable.rows[numRows-1].lastChild.innerHTML= "";
			thisTable.rows[numRows-1].lastChild = makeSocket(thisTable.rows[numRows-1].lastChild, numRows-1, false);
			
			
			var row = thisTable.insertRow(numRows);
			var cell0 = document.createElement("th");
			row.appendChild(cell0);

			var cell1 = document.createElement("td");
			var newButton = makeButton(idNum, false);
			cell1.appendChild(newButton);
			row.appendChild(cell1);
			return;
		}

		function makeButton(idNum, isTrig){
			
			var button = document.createElement("button");
			button.setAttribute("name", "actionButton");
			button.innerHTML = "Click to add an Action";
			button.className = "newAction";
			if (isTrig) {
				button.setAttribute("id", triggerCounter++);
			}
			else {
				button.setAttribute("id", idNum);
			}
			button.setAttribute("onclick","newRow(this.id)");
			return button;
		}
		function makeSocket(mountLoc,idNum,isTrig) {
			var socket = document.createElement("div");
			if (isTrig) {
				socket.className = "triggerSocket";
				var idTxt = "tSock" + idNum;
				socket.setAttribute("id", idTxt);
				socket.setAttribute("ondrop","drop(event)");
				socket.setAttribute("ondragover","allowDrop(event)");
				socket.innerHTML = idTxt;
				socket = makeDragBlock(socket,idNum, true);
			}
			else {
				socket.className = "actionSocket";
				var idTxt = "aSock" + idNum;
				socket.setAttribute("id", idTxt);
				socket.setAttribute("ondrop","drop(event)");
				socket.setAttribute("ondragover","allowDrop(event)");
				socket.innerHTML = idTxt;
				socket = makeDragBlock(socket,idNum, false);
			}
			mountLoc.appendChild(socket);
			return mountLoc;
		}


		function makeDragBlock(startSocket,idNum,isTrig) {
			var dragBlock = document.createElement("div");
			if (isTrig) {
				dragBlock.className = "triggerBlock";
				var idTxt = "tDrag" + idNum;
				dragBlock.setAttribute("id", idTxt);
				dragBlock.setAttribute("draggable","true");
				dragBlock.setAttribute("ondragstart","drag(event)");

				dragBlock.removeAttribute("ondrop", "dummy()");// disable inherited socket properties
				dragBlock.setAttribute("ondragover", "dummy()");// disable inherited socket properties

				dragBlock.innerHTML = idTxt;
				startSocket.appendChild(dragBlock);
				return startSocket;
			}
			else {
				dragBlock.className = "actionBlock";
				var idTxt = "aDrag" + idNum;
				dragBlock.setAttribute("id", idTxt);
				dragBlock.setAttribute("draggable","true");
				dragBlock.setAttribute("ondragstart","drag(event)");
				console.log(dragBlock);

				dragBlock.setAttribute("ondrop", "dummy(event)");// disable inherited socket properties
				dragBlock.setAttribute("ondragover", "dummy(event)");// disable inherited socket properties

				console.log(dragBlock);
				dragBlock.innerHTML = idTxt;
				startSocket.appendChild(dragBlock);
				return startSocket;
			}
		}

		function allowDrop(ev) {
			ev.preventDefault();
		}
		function drag(ev) {
			ev.dataTransfer.setData("text", ev.target.id);
		}
		function drop(ev) {
			ev.preventDefault();
   			var data = ev.dataTransfer.getData("text");
    		ev.target.appendChild(document.getElementById(data));
		}
		function dummy(ev) {}
	</script>
</body>
</html>
