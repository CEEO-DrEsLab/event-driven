<!-- 
	Created by Caleb Lucas-Foley
	2016-07-11
-->

<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Layout concept</title>
	<style>
	* {
		margin: 0px;
	}
	html, body {
		height: 100%;
		width: 100%;
	}
	/* Column column-header class */
	.column-header {
		text-align: center;
		background-color: magenta;
	}
	/* Left column (trigger channel sidebar) */
	.left-column {
		width: 250px;
		float: left;
	}
	/* Right column (action channel sidebar) */
	.right-column {
		width: 250px;
		float: right;
	}
	/* Center column (code area) */
	.center-column {
		margin: auto;
	}
	/* Class for left and right sidebars */
	.sidebar {
		height: 100%;
		background-color: chartreuse;
		overflow: auto;
	}
	/* Class for code areas */
	.code-area {
		height: 100%;
		background-color: indigo;
		overflow: auto;
	}
	/* Channel block */
	.channel-block {
		height: 100px;
		width: 100px;
		text-align: center;
		background-color: azure;
		margin: 10px auto; /* centers horizontally */
		border-style: outset;
	}
	/* Button to add new blocks */
	.button-add {
		height: 50px;
		width: 50px;
		display: block;
		margin: 10px auto;
	}
	/* Trigger Code Block */
	.trigger-block {
		height: 100px;
		width: 200px;
		float: right;
		margin-right: 50%;
		background-color: forestgreen;
		border-style: outset;
	}
	/* Action Code Block */
	div.action-block {
		height: 100px;
		width: 200px;
		background-color: crimson;
		border-style: outset;
	}
	.action-block {
		display: block;
		position: relative;
		left: 50%;
	}
	/* Trigger-action pair container */
	.pair-container {
		background-color: cyan;
		margin: 10px; /* centers horizontally */
		min-height: 100px;
	}
	</style>
	<script async>
	//////////////////////////////////////////////////////////////////////
	///////////////////////////// Constants //////////////////////////////
	//////////////////////////////////////////////////////////////////////

	// EV3 Constants
	var PORT_TYPES = {
		"1": "sensor",
		"2": "sensor",
		"3": "sensor",
		"4": "sensor",
		"A": "motor",
		"B": "motor",
		"C": "motor",
		"D": "motor",
		"BRICK BUTTON": "brick in",
		"BRICK LIGHT": "brick out",
		"BRICK SOUND": "brick out",
	};
	var SENSORS = ["Touch Sensor", "Ultrasonic Sensor", "Color Sensor"];
	var MOTORS = ["Large Motor", "Medium Motor"];


	//////////////////////////////////////////////////////////////////////
	///////////////////////////// Code Model /////////////////////////////
	//////////////////////////////////////////////////////////////////////

	var portConfig = {};

	// var triggerChannels = [];

	// var actionChannels = [];

	var channels = [];

	var code = {}; //{<channel>:{<trigger>:[<action>,],},};


	//////////////////////////////////////////////////////////////////////
	////////////////////////// New Block Setup ///////////////////////////
	//////////////////////////////////////////////////////////////////////

	// Makes a custom channel (GUI only)
	function makeChannel() {
		var peripheral = prompt("Enter Peripheral Name:");
		var port = prompt("Which port is the " + peripheral + " in?");
		portConfig[port] = peripheral;
		channels.push(port + " (" + peripheral +")");
		return [peripheral, port];
	}

	function makeTriggerBlock () {
		var newTrigger = document.createElement("div");
		newTrigger.className = "trigger-block";
		newTrigger.innerHTML = "Port:";
		var channelSelect = document.createElement("select");
		for (i in channels) {
			var newOption = document.createElement("option");
			newOption.value = channels[i];
			newOption.innerHTML = channels[i];
			channelSelect.appendChild(newOption);
		}
		newTrigger.appendChild(channelSelect);
		return newTrigger;
	}

	function makeActionBlock () {
		var newAction = document.createElement("div");
		newAction.className = "action-block";
		newAction.innerHTML = "Port:";
		var channelSelect = document.createElement("select");
		for (i in channels) {
			var newOption = document.createElement("option");
			newOption.value = channels[i];
			newOption.innerHTML = channels[i];
			channelSelect.appendChild(newOption);
		}
		newAction.appendChild(channelSelect);
		return newAction;
	}


	//////////////////////////////////////////////////////////////////////
	/////////////////////// Adding New Code Blocks ///////////////////////
	//////////////////////////////////////////////////////////////////////

	// Adds a new channel block above the specified element
	function addChannelBlockAbove(button) {
		channelData = makeChannel();
		if (channelData[0] != null && channelData[1] != null) {
			var newNode = document.createElement("div");
			newNode.className = "channel-block";
			newNode.innerHTML = channelData[0] + "<br/>(port: " + channelData[1] + ")";
			button.parentNode.insertBefore(newNode, button);
		} else {
			alert("Error creating channel (please specify port  and peripheral)")
		}

	}

	// Adds a new action block above the specified element
	function addActionAbove(button) {
		button.parentNode.insertBefore(makeActionBlock(), button);
	}

	// Adds a new trigger (with add-action button) above the specified element
	function addPairAbove(button) {
		var newPair = document.createElement("div");
		newPair.className = "pair-container";

		var newButton = document.createElement("button");
		newButton.className = "action-block";
		newButton.innerHTML = "+";
		newButton.setAttribute("onclick", "addActionAbove(this)");

		newPair.appendChild(makeTriggerBlock());
		newPair.appendChild(newButton);

		button.parentNode.insertBefore(newPair, button);
	}
	</script>
</head>

<body>
	<div class="left-column column-header">Triggers:</div>
	<div class="right-column column-header">Actions:</div>
	<div class="center-column column-header">Code:</div>
	<div class="left-column sidebar">
		<button class="button-add" onclick="addChannelBlockAbove(this)">+</button>
	</div>
	<div class="right-column sidebar">
		<button class="button-add" onclick="addChannelBlockAbove(this)">+</button>
	</div>
	<div class="center-column code-area">
		<button class="button-add" onclick="addPairAbove(this)">+</button>
	</div>
</body>

</html>